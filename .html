<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Essys Essentials</title>
<style>
  :root {
    --main-color: #2a9d8f;
    --accent-color: #e76f51;
    --bg-color: #f4f4f4;
    --text-color: #333;
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    margin: 0; background: var(--bg-color); font-family: var(--font-family); color: var(--text-color);
  }
  header, footer {
    background: var(--main-color); color: white; padding: 1rem; text-align: center;
  }
  .logo {
    height: 50px; vertical-align: middle;
    margin-right: 1rem;
  }
  header h1 {
    display: inline-block;
    vertical-align: middle;
    margin: 0;
  }
  nav {
    margin-top: 1rem;
    text-align: center;
  }
  nav button {
    margin: 0 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    background: var(--accent-color);
    color: white;
    border-radius: 4px;
    cursor: pointer;
  }
  nav button:hover {
    background: #d45a39;
  }
  main {
    max-width: 900px; margin: auto; padding: 1rem;
  }
  button {
    background: var(--accent-color); border: none; color: white; padding: 0.5rem 1rem; cursor: pointer; border-radius: 4px;
  }
  button:hover {
    background: #d45a39;
  }
  .product-grid {
    display: grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap: 1rem;
  }
  .product-card {
    background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    display: flex; flex-direction: column;
  }
  .product-card img {
    width: 100%; height: 150px; object-fit: contain; border-radius: 4px;
  }
  .product-card h3 {
    margin: 0.5rem 0 0.2rem;
  }
  .product-card p {
    flex-grow: 1;
  }
  .cart {
    position: fixed; top: 1rem; right: 1rem; background: var(--accent-color); color: white; padding: 0.5rem 1rem; border-radius: 50%;
    font-weight: bold; cursor: pointer;
  }
  .hidden { display: none; }
  #adminPanel {
    background: white; padding: 1rem; max-width: 600px; margin: 1rem auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  #adminPanel input, #adminPanel textarea, #adminPanel select {
    width: 100%; margin-bottom: 0.5rem; padding: 0.4rem; border-radius: 4px; border: 1px solid #ccc;
  }
  #customization {
    margin-top: 1rem;
    border-top: 1px solid #ddd;
    padding-top: 1rem;
  }
  #messageBox {
    margin-top: 1rem;
    padding: 0.5rem; background: #eee; border-radius: 4px; min-height: 2rem;
  }
  #whatsappContact {
    position: fixed; bottom: 1rem; right: 1rem; background: #25D366; color: white; padding: 0.75rem 1rem; border-radius: 50px; font-weight: bold;
    text-decoration: none;
  }
  nav {
    margin-bottom: 1rem; text-align: center;
  }
  nav button {
    margin: 0 0.5rem;
  }
  .pagination {
    margin-top: 1rem; text-align: center;
  }
  .pagination button {
    margin: 0 0.25rem;
    padding: 0.3rem 0.7rem;
    border-radius: 4px;
    border: 1px solid var(--accent-color);
    background: white;
    color: var(--accent-color);
    cursor: pointer;
  }
  .pagination button:disabled {
    background: var(--accent-color);
    color: white;
    cursor: default;
  }
  #adminLoginModal {
    position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.7); 
    display:flex; align-items:center; justify-content:center; z-index: 1000;
  }
  #adminLoginModal > div {
    background:white; padding: 2rem; border-radius: 8px; max-width: 300px; width: 90%;
    box-sizing: border-box;
  }
  #adminLoginModal input {
    width: 100%; padding: 0.5rem; margin-bottom: 1rem; box-sizing: border-box;
  }
  #adminLoginModal button {
    margin-right: 0.5rem;
  }
  #shopLinkInput {
    padding: 0.5rem;
    width: 100%;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  #copySuccessMsg {
    color: green;
    margin-top: 0.3rem;
    font-size: 0.9rem;
    display: none;
  }
</style>
</head>
<body>

<header>
  <img src="" alt="Logo" id="siteLogo" class="logo" />
  <h1>Essys Essentials</h1>
  <nav>
    <button id="adminLoginBtn">Admin Login</button>
    <button id="adminLogoutBtn" class="hidden">Logout Admin</button>
    <button id="viewCartBtn">Cart (<span id="cartCount">0</span>)</button>
  </nav>
</header>

<main id="customerView">

  <div id="productGrid" class="product-grid"></div>

  <div class="pagination" id="pagination"></div>

  <div id="messageBox"></div>

  <div id="checkoutSection" class="hidden">
    <h2>Checkout</h2>
    <p>Bank Transfer Info:</p>
    <p id="bankDetails"></p>
    <p>Or pay with card (mock payment):</p>
    <button id="mockPayBtn">Pay with Card</button>
    <button id="backToShopBtn">Back to Shop</button>
  </div>

</main>

<div id="adminPanel" class="hidden">
  <h2>Admin Panel</h2>
  <label>Upload Product Image:</label>
  <input type="file" id="productImageInput" accept="image/*" capture="environment" />
  <label>Product Name:</label>
  <input type="text" id="productNameInput" />
  <label>Product Description:</label>
  <textarea id="productDescInput"></textarea>
  <label>Product Price (â‚¦):</label>
  <input type="number" id="productPriceInput" min="0" />
  <button id="addProductBtn">Add Product</button>

  <hr />

  <h3>Customize Website</h3>
  <label>Business Logo:</label>
  <input type="file" id="logoUpload" accept="image/*" />
  <label>Main Color:</label>
  <input type="color" id="colorPickerMain" value="#2a9d8f" />
  <label>Accent Color:</label>
  <input type="color" id="colorPickerAccent" value="#e76f51" />
  <label>Background Color:</label>
  <input type="color" id="colorPickerBg" value="#f4f4f4" />
  <label>Font Color:</label>
  <input type="color" id="colorPickerText" value="#333333" />
  <button id="saveCustomizationBtn">Save Customization</button>

  <hr />

  <h3>Business Info</h3>
  <label>WhatsApp Number (include country code, e.g. +2348012345678):</label>
  <input type="text" id="whatsappInput" placeholder="+234..." />
  <label>Bank Account Details:</label>
  <textarea id="bankInput" placeholder="Bank name, Account number, Account name..."></textarea>

  <hr />

  <h3>Custom Message for Customers</h3>
  <textarea id="customMessageInput" placeholder="Write a message to customers here..."></textarea>
  <button id="saveMessageBtn">Save Message</button>

  <hr />

  <h3>Share Shop Link</h3>
  <input type="text" id="shopLinkInput" readonly />
  <button id="copyShopLinkBtn">Copy Link</button>
  <p id="copySuccessMsg">Link copied to clipboard!</p>
</div>

<!-- Admin Login Modal -->
<div id="adminLoginModal" class="hidden">
  <div>
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter password" />
    <button id="adminLoginSubmitBtn">Login</button>
    <button id="adminLoginCancelBtn">Cancel</button>
    <p id="loginError" style="color: red; margin-top: 0.5rem;"></p>
  </div>
</div>

<a href="#" id="whatsappContact" target="_blank" class="hidden">WhatsApp Us</a>

<script>
  // Data keys for localStorage
  const STORAGE_PRODUCTS = 'ee_products';
  const STORAGE_CUSTOMIZATION = 'ee_customization';
  const STORAGE_CART = 'ee_cart';

  let products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)) || [];
  let customization = JSON.parse(localStorage.getItem(STORAGE_CUSTOMIZATION)) || {
    mainColor: '#2a9d8f',
    accentColor: '#e76f51',
    bgColor: '#f4f4f4',
    textColor: '#333333',
    logoDataUrl: '',
    whatsapp: '',
    bankDetails: '',
    customMessage: '',
  };
  let cart = JSON.parse(localStorage.getItem(STORAGE_CART)) || [];
  let adminLoggedIn = false;
  const adminPassword = 'admin123';

  // Elements
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');
  const adminLoginModal = document.getElementById('adminLoginModal');
  const adminLoginSubmitBtn = document.getElementById('adminLoginSubmitBtn');
  const adminLoginCancelBtn = document.getElementById('adminLoginCancelBtn');
  const adminPasswordInput = document.getElementById('adminPassword');
  const loginError = document.getElementById('loginError');
  const adminPanel = document.getElementById('adminPanel');
  const customerView = document.getElementById('customerView');
  const productGrid = document.getElementById('productGrid');
  const addProductBtn = document.getElementById('addProductBtn');
  const productImageInput = document.getElementById('productImageInput');
  const productNameInput = document.getElementById('productNameInput');
  const productDescInput = document.getElementById('productDescInput');
  const productPriceInput = document.getElementById('productPriceInput');
  const logoUpload = document.getElementById('logoUpload');
  const colorPickerMain = document.getElementById('colorPickerMain');
  const colorPickerAccent = document.getElementById('colorPickerAccent');
  const colorPickerBg = document.getElementById('colorPickerBg');
  const colorPickerText = document.getElementById('colorPickerText');
  const saveCustomizationBtn = document.getElementById('saveCustomizationBtn');
  const siteLogo = document.getElementById('siteLogo');
  const whatsappInput = document.getElementById('whatsappInput');
  const whatsappContact = document.getElementById('whatsappContact');
  const bankInput = document.getElementById('bankInput');
  const bankDetailsDisplay = document.getElementById('bankDetails');
  const customMessageInput = document.getElementById('customMessageInput');
  const saveMessageBtn = document.getElementById('saveMessageBtn');
  const cartCount = document.getElementById('cartCount');
  const viewCartBtn = document.getElementById('viewCartBtn');
  const checkoutSection = document.getElementById('checkoutSection');
  const mockPayBtn = document.getElementById('mockPayBtn');
  const backToShopBtn = document.getElementById('backToShopBtn');
  const paginationDiv = document.getElementById('pagination');
  const shopLinkInput = document.getElementById('shopLinkInput');
  const copyShopLinkBtn = document.getElementById('copyShopLinkBtn');
  const copySuccessMsg = document.getElementById('copySuccessMsg');

  // Pagination
  const productsPerPage = 6;
  let currentPage = 1;

  // Save all data to localStorage
  function saveData(){
    localStorage.setItem(STORAGE_PRODUCTS, JSON.stringify(products));
    localStorage.setItem(STORAGE_CUSTOMIZATION, JSON.stringify(customization));
    localStorage.setItem(STORAGE_CART, JSON.stringify(cart));
  }

  // Render products with pagination
  function renderProducts(){
    productGrid.innerHTML = '';
    if(products.length === 0){
      productGrid.innerHTML = '<p>No products available.</p>';
      paginationDiv.innerHTML = '';
      return;
    }
    const start = (currentPage - 1) * productsPerPage;
    const end = start + productsPerPage;
    const pageProducts = products.slice(start, end);

    pageProducts.forEach((p, idx) => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img src="${p.image}" alt="${p.name}" />
        <h3>${p.name}</h3>
        <p>${p.description}</p>
        <p><strong>â‚¦${p.price.toFixed(2)}</strong></p>
        <button data-index="${start + idx}">Add to Cart</button>
      `;
      productGrid.appendChild(card);
    });

    const totalPages = Math.ceil(products.length / productsPerPage);
    paginationDiv.innerHTML = '';
    if(totalPages > 1){
      for(let i = 1; i <= totalPages; i++){
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.disabled = (i === currentPage);
        btn.addEventListener('click', () => {
          currentPage = i;
          renderProducts();
        });
        paginationDiv.appendChild(btn);
      }
    }
  }

  // Update cart count badge
  function updateCartCount(){
    cartCount.textContent = cart.length;
  }

  // Add product to cart
  function addToCart(index){
    cart.push(products[index]);
    updateCartCount();
    saveData();
    alert('Product added to cart!');
  }

  // Show checkout section
  function showCheckout(){
    productGrid.style.display = 'none';
    paginationDiv.style.display = 'none';
    document.getElementById('messageBox').style.display = 'none';
    checkoutSection.classList.remove('hidden');
    bankDetailsDisplay.textContent = customization.bankDetails || 'No bank details provided.';
  }

  // Hide checkout section and return to shop view
  function hideCheckout(){
    checkoutSection.classList.add('hidden');
    productGrid.style.display = '';
    paginationDiv.style.display = '';
    document.getElementById('messageBox').style.display = '';
  }

  // Update UI for customization inputs from saved data
  function updateCustomizationUI(){
    colorPickerMain.value = customization.mainColor;
    colorPickerAccent.value = customization.accentColor;
    colorPickerBg.value = customization.bgColor;
    colorPickerText.value = customization.textColor;
    siteLogo.src = customization.logoDataUrl || '';
    whatsappInput.value = customization.whatsapp;
    bankInput.value = customization.bankDetails;
    customMessageInput.value = customization.customMessage;
    updateThemeColors();
    updateWhatsAppContact();
    renderMessage();
    updateShopLink();
  }

  // Update theme colors on root
  function updateThemeColors(){
    document.documentElement.style.setProperty('--main-color', customization.mainColor);
    document.documentElement.style.setProperty('--accent-color', customization.accentColor);
    document.documentElement.style.setProperty('--bg-color', customization.bgColor);
    document.documentElement.style.setProperty('--text-color', customization.textColor);
  }

  // Update WhatsApp contact button link and visibility
  function updateWhatsAppContact(){
    if(customization.whatsapp){
      const cleanNum = customization.whatsapp.replace(/\D/g,'');
      whatsappContact.href = `https://wa.me/${cleanNum}`;
      whatsappContact.classList.remove('hidden');
    } else {
      whatsappContact.classList.add('hidden');
    }
  }

  // Render custom message to customers
  function renderMessage(){
    const messageBox = document.getElementById('messageBox');
    messageBox.textContent = customization.customMessage;
  }

  // Update shop link input value
  function updateShopLink(){
    shopLinkInput.value = window.location.href;
  }

  // Event listeners

  // Admin login button: show modal
  adminLoginBtn.addEventListener('click', () => {
    adminLoginModal.classList.remove('hidden');
    adminPasswordInput.value = '';
    loginError.textContent = '';
  });

  // Admin login cancel button: hide modal
  adminLoginCancelBtn.addEventListener('click', () => {
    adminLoginModal.classList.add('hidden');
  });

  // Admin login submit button: check password
  adminLoginSubmitBtn.addEventListener('click', () => {
    const enteredPassword = adminPasswordInput.value.trim();
    if(enteredPassword === adminPassword){
      adminLoggedIn = true;
      adminLoginModal.classList.add('hidden');
      adminLoginBtn.classList.add('hidden');
      adminLogoutBtn.classList.remove('hidden');
      adminPanel.classList.remove('hidden');
      updateCustomizationUI();
      renderProducts();
      updateCartCount();
    } else {
      loginError.textContent = 'Incorrect password!';
    }
  });

  // Admin logout button
  adminLogoutBtn.addEventListener('click', () => {
    adminLoggedIn = false;
    adminLoginBtn.classList.remove('hidden');
    adminLogoutBtn.classList.add('hidden');
    adminPanel.classList.add('hidden');
    renderProducts();
    updateCartCount();
  });

  // Add product button
  addProductBtn.addEventListener('click', () => {
    const name = productNameInput.value.trim();
    const desc = productDescInput.value.trim();
    const price = parseFloat(productPriceInput.value);
    if(!name || !desc || isNaN(price) || price < 0){
      alert('Please fill all product details correctly.');
      return;
    }
    if(productImageInput.files.length === 0){
      alert('Please select a product image.');
      return;
    }
    const reader = new FileReader();
    reader.onload = function(e){
      products.push({
        name,
        description: desc,
        price,
        image: e.target.result,
      });
      saveData();
      renderProducts();
      productNameInput.value = '';
      productDescInput.value = '';
      productPriceInput.value = '';
      productImageInput.value = '';
      alert('Product added!');
    }
    reader.readAsDataURL(productImageInput.files[0]);
  });

  // Save customization button
  saveCustomizationBtn.addEventListener('click', () => {
    customization.mainColor = colorPickerMain.value;
    customization.accentColor = colorPickerAccent.value;
    customization.bgColor = colorPickerBg.value;
    customization.textColor = colorPickerText.value;
    customization.whatsapp = whatsappInput.value.trim();
    customization.bankDetails = bankInput.value.trim();
    if(logoUpload.files.length > 0){
      const reader = new FileReader();
      reader.onload = function(e){
        customization.logoDataUrl = e.target.result;
        siteLogo.src = customization.logoDataUrl;
        saveData();
        updateThemeColors();
        updateWhatsAppContact();
        alert('Customization saved!');
        updateShopLink();
      }
      reader.readAsDataURL(logoUpload.files[0]);
    } else {
      saveData();
      updateThemeColors();
      updateWhatsAppContact();
      alert('Customization saved!');
      updateShopLink();
    }
  });

  // Save custom message button
  saveMessageBtn.addEventListener('click', () => {
    customization.customMessage = customMessageInput.value.trim();
    saveData();
    renderMessage();
    alert('Message saved!');
  });

  // Add to cart buttons in product grid
  productGrid.addEventListener('click', e => {
    if(e.target.tagName === 'BUTTON'){
      const index = parseInt(e.target.getAttribute('data-index'));
      addToCart(index);
    }
  });

  // View cart button
  viewCartBtn.addEventListener('click', () => {
    if(cart.length === 0){
      alert('Cart is empty!');
      return;
    }
    showCheckout();
  });

  // Mock pay button
  mockPayBtn.addEventListener('click', () => {
    alert('Thank you for your payment! Your order has been received.');
    cart = [];
    updateCartCount();
    saveData();
    hideCheckout();
  });

  // Back to shop button
  backToShopBtn.addEventListener('click', () => {
    hideCheckout();
  });

  // Copy shop link button
  copyShopLinkBtn.addEventListener('click', () => {
    shopLinkInput.select();
    shopLinkInput.setSelectionRange(0, 99999); // For mobile devices
    navigator.clipboard.writeText(shopLinkInput.value).then(() => {
      copySuccessMsg.style.display = 'block';
      setTimeout(() => copySuccessMsg.style.display = 'none', 2000);
    }).catch(() => {
      alert('Failed to copy link. Please copy manually.');
    });
  });

  // Initialize UI
  function init(){
    updateThemeColors();
    updateWhatsAppContact();
    siteLogo.src = customization.logoDataUrl || '';
    renderProducts();
    renderMessage();
    updateCartCount();
    updateShopLink();
  }

  init();
</script>

</body>
</html>
